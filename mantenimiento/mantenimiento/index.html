<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Mantenimiento - IT Solutions</title>

  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />


<style>
    
    /* Reset y estilos generales */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body, html {
      height: 100%;
      width: 100%;
      overflow-x: hidden;
    }

    /* Video de fondo solo para el login */
    #video-fondo {
      position: fixed;
      top: 0;
      left: 0;
      min-width: 220%;
      min-height: 100%;
      object-fit: cover;
      z-index: -1;
      display: none;
    }

    /* Estilos para el login */
    .login-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .login-box {
      background: rgba(221, 229, 252, 0.85);
      padding: 2.5rem;
      border-radius: 10px;
      box-shadow: 0 15px 35px rgba(250, 4, 4, 0.3);
      width: 100%;
      max-width: 400px;
      text-align: center;
      backdrop-filter: blur(5px);
    }

    .login-box h2 {
      color: #2a5298;
      margin-bottom: 1.5rem;
      font-weight: 2000;
    }

    .login-box input {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 1rem;
      border: 1px solid #2c0ce0;
      border-radius: 5px;
      font-size: 14px;
      transition: border 0.3s;
      background: rgba(255, 255, 255, 0.8);
    }

    .login-box input:focus {
      border-color: #2a5298;
      outline: none;
    }

    .login-box button {
      width: 100%;
      padding: 12px;
      background-color: #2a5298;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .login-box button:hover {
      background-color: #1e3c72;
    }

    #error-login {
      color: #f71b03;
      margin-top: 1rem;
      font-size: 14px;
      min-height: 20px;
    }

    /* Estilos para la aplicación */
    #app {
      display: none;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      min-height: 100vh;
      background: #f5f7fa;
    }

    /* Barra de navegación */
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #ddd;
    }

    .app-title h1 {
      color: #2a5298;
      font-size: 1.8rem;
    }

    .app-title p {
      color: #666;
      font-size: 0.9rem;
    }

    .nav-buttons {
      display: flex;
      gap: 10px;
    }

    .nav-buttons button {
      padding: 8px 16px;
      background-color: #2a5298;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .nav-buttons button:hover {
      background-color: #1e3c72;
    }

    .logout-btn {
      background-color: #e74c3c !important;
    }

    .logout-btn:hover {
      background-color: #c0392b !important;
    }

    /* Resumen de estadísticas */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      text-align: center;
      transition: transform 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .stat-card h3 {
      color: #666;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    .stat-card p {
      color: #2a5298;
      font-size: 1.8rem;
      font-weight: 600;
    }

    /* Formulario de registro */
    #registrar {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      margin-bottom: 2rem;
    }

    #registrar h2 {
      color: #2a5298;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #eee;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 1.5rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #555;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      transition: border 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: #2a5298;
      outline: none;
      box-shadow: 0 0 0 2px rgba(42, 82, 152, 0.1);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-actions {
      text-align: right;
      margin-top: 1rem;
    }

    .form-actions button {
      padding: 10px 20px;
      background-color: #2a5298;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      font-weight: 500;
    }

    .form-actions button:hover {
      background-color: #1e3c72;
    }

    /* Lista de registros */
    #lista {
      list-style: none;
    }

    .registro-item {
      background: white;
      padding: 1.5rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .registro-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .registro-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }

    .registro-title {
      font-weight: 600;
      color: #2a5298;
      font-size: 1.1rem;
    }

    .registro-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .registro-actions button {
      padding: 5px 10px;
      font-size: 0.8rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: opacity 0.3s;
    }

    .registro-actions button:hover {
      opacity: 0.9;
    }

    .edit-btn {
      background-color: #3498db;
      color: white;
    }

    .delete-btn {
      background-color: #e74c3c;
      color: white;
    }

    .registro-details {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }

    .detail-item {
      margin-bottom: 0.5rem;
    }

    .detail-label {
      font-size: 0.8rem;
      color: #777;
      font-weight: 500;
    }

    .detail-value {
      font-size: 0.9rem;
      color: #333;
      word-break: break-word;
    }

    /* Sección de búsqueda */
    #buscar {
      display: none;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    #buscar h2 {
      color: #2a5298;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #eee;
    }

    .search-controls {
      display: flex;
      gap: 15px;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .search-controls input {
      flex: 1;
      min-width: 200px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }

    .search-controls button {
      padding: 10px 20px;
      background-color: #2a5298;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
    }

    .search-controls button:hover {
      background-color: #1e3c72;
    }

    .date-filters {
      display: flex;
      gap: 15px;
      margin-bottom: 1.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .date-filters label {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9rem;
      color: #555;
    }

    .date-filters input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    /* Modales */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .modal.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    }
    #historial-contenido {
  margin-top: 1rem;
  max-height: 60vh;
  overflow-y: auto;
}
.close-modal-historial {
  position: absolute;
  top: 12px;
  right: 12px;
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
  z-index: 10;
  transition: transform 0.2s ease;
}

.close-modal-historial svg {
  display: block;
  transition: transform 0.3s ease;
}

.close-modal-historial:hover svg {
  transform: scale(1.1);
}

.close-modal-historial svg circle {
  transition: fill 0.3s ease;
}

.close-modal-historial:hover svg circle {
  fill: #c0392b; /* Color más oscuro al hacer hover */
}


    .close-modal:hover {
      color: #333;
    }

    /* Estado de los registros */
    .status-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-pendiente {
      background-color: #f39c12;
      color: white;
    }

    .status-progreso {
      background-color: #3498db;
      color: white;
    }

    .status-finalizado {
      background-color: #2ecc71;
      color: white;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .login-box {
        padding: 1.5rem;
        margin: 0 15px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .registro-details {
        grid-template-columns: 1fr;
      }

      .stats-container {
        grid-template-columns: 1fr 1fr;
      }

      .app-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }

      .nav-buttons {
        width: 100%;
        justify-content: space-between;
      }

      .modal-content {
        padding: 1.5rem;
      }
    }

    @media (max-width: 480px) {
      .login-box {
        padding: 1.2rem;
      }

      .stats-container {
        grid-template-columns: 1fr;
      }

      .date-filters {
        flex-direction: column;
        align-items: flex-start;
      }
    }
    .titulo-con-imagen {
  position: relative;
  display: inline-block;
  padding: 1rem 2rem;
  z-index: 0;
}

.titulo-con-imagen h1 {
  position: relative;
  z-index: 2;
  padding-left: 150px;
  color: #2a0591; /* o blanco si lo necesitas encima de imagen oscura */
}
.titulo-con-imagen p {
  position: relative;
  z-index: 2;
  padding-left: 150px;
  color: #0c0324; /* o blanco si lo necesitas encima de imagen oscura */
}

.titulo-con-imagen::before {
  content: "";
  position: absolute;
  top: -40px; 
  margin-left: -80px;
  width: 230px;               /* Mismo ancho */
  height: 220px;              /* que el alto (círculo) */
  background-image: url('VIDEO/logo-aliar.png'); /* Ruta de tu imagen */
  background-size: cover;    /* Asegura que llene el círculo */
  background-repeat: no-repeat;
  background-position: center;
  border-radius: 50%;        /* Hace que sea redonda */
  z-index: 1;
  pointer-events: none;
}
.nav-buttons-container {
  position: relative;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  padding-right: 1rem;
}

.choices__item--choice {
  white-space: nowrap;       /* Evita salto de línea */
  overflow: hidden;          /* Oculta texto que se desborde */
  max-width: 250%;           /* Limita al ancho del contenedor */
}

.mensaje-vacio {
  color: #e74c3c;         /* Rojo moderno */
  text-align: center;
  font-weight: bold;
  font-size: 1rem;
  margin-top: 1rem;
}
.titulo-animado {
  opacity: 0;
  transform: translateY(20px);
  animation: aparecer 1.5s ease-out forwards;
  animation-delay: 0.5s;
}

.parrafo-animado {
  opacity: 0;
  transform: translateY(20px);
  animation: aparecer 1.5s ease-out forwards;
  animation-delay: 1s;
}

@keyframes aparecer {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.titulo-animado {
  opacity: 0;
  transform: translateY(20px);
  animation: aparecer 1.5s ease-out forwards;
  animation-delay: 0.5s;
  font-size: 2rem;
  color: #0a0a23;
  font-weight: 800;
  margin-bottom: 0.5rem;
  letter-spacing: 1px;
}

.parrafo-animado {
  opacity: 0;
  transform: translateY(20px);
  animation: aparecer 1.5s ease-out forwards;
  animation-delay: 1s;
  font-size: 1rem;
  color: #333;
  font-weight: 600;
  margin-bottom: 1.5rem;
}

.alerta-sistema {
  font-size: 0.85rem;
  color: #792020;
  font-weight: 600;
  margin-top: 1rem;
}

@keyframes aparecer {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.alerta-sistema {
  font-size: 0.85rem;
  color: #792020;
  font-weight: 600;
  margin-top: 1rem;
  background-color: #ffe5e5;
  padding: 10px;
  border-radius: 5px;
  transition: opacity 1s ease, transform 1s ease;
}

.alerta-oculta {
  opacity: 0;
  transform: translateY(-10px);
  pointer-events: none;
}
.error-login {
  color: #721c24;
  background-color: #f8d7da;
  border: 1px solid #f5c6cb;
  padding: 10px;
  margin-top: 1rem;
  font-weight: bold;
  border-radius: 5px;
  text-align: center;
  opacity: 0;
  transform: translateY(-10px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}

.error-login.visible {
  opacity: 1;
  transform: translateY(0);
}

.error-login.oculto {
  display: none;
}
.login-box {
  position: relative;
  background: rgba(221, 229, 252, 0.85);
  padding: 2.5rem;
  border-radius: 10px;
  box-shadow: 0 15px 35px rgba(250, 4, 4, 0.3);
  width: 100%;
  max-width: 400px;
  text-align: center;
  backdrop-filter: blur(5px);
  overflow: hidden;
}

/* Línea luminosa que recorre los bordes */
.esquinas-luz {
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 10px;
  pointer-events: none;
  z-index: 0;
}

.esquinas-luz::before {
  content: "";
  position: absolute;
  width: 60px;
  height: 4px;
  background: #00f0ff;
  box-shadow: 0 0 10px #00f0ff, 0 0 20px #00f0ff;
  animation: recorrer-bordes 8s linear infinite;
}

@keyframes recorrer-bordes {
  0% {
    top: 0;
    left: 0;
    transform: rotate(0deg);
  }
  25% {
    top: 0;
    left: 100%;
    transform: rotate(90deg);
  }
  50% {
    top: 100%;
    left: 100%;
    transform: rotate(180deg);
  }
  75% {
    top: 100%;
    left: 0;
    transform: rotate(270deg);
  }
  100% {
    top: 0;
    left: 0;
    transform: rotate(360deg);
  }
}
.emoji-rebotando {
  position: absolute;
  font-size: 20px;
  z-index: 0;
  pointer-events: none;
  animation: brillo 1s infinite alternate;
}

@keyframes brillo {
  0% {
    filter: drop-shadow(0 0 3px #00f0ff);
  }
  100% {
    filter: drop-shadow(0 0 10px #00f0ff);
  }
}


  </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <!-- Video de fondo solo en login -->
  <video id="video-fondo" autoplay muted loop>
    <source src="VIDEO/VIDEO-MP4.mp4" type="video/mp4">
    Tu navegador no soporta video.
  </video>

  <!-- Pantalla de Login -->
  <div class="login-container" id="login">
  <div class="login-box">
    <span class="esquinas-luz"></span>
    <span class="emoji-rebotando" id="emoji-rebotando">🛠️</span>
    <h2 class="titulo-animado">
      🛠️ Mantenimientos Tecnología
    </h2>
    <p class="parrafo-animado">
      Ingrese sus credenciales para acceder
    </p>

    <form id="login-form">
      <input type="text" id="usuario" placeholder="Usuario" required>
      <input type="password" id="clave" placeholder="Contraseña" required>
      <button type="submit">Iniciar Sesión</button>
<p class="alerta-sistema" id="alerta-sistema">
  ⚠️ Esta página está siendo supervisada. Cualquier intento de acceso no autorizado o robo de información será detectado y notificado a los administradores del sistema.
</p>

    <p id="error-login" class="error-login oculto"></p>

    </form>
  </div>
</div>

  <!-- Aplicación principal -->
  <div id="app">
    <header class="app-header">
      <div class="titulo-con-imagen">
        <h1 class="titulo-animado">Mantenimiento Tecnológico</h1>
<p class="parrafo-animado">Registro de equipos informáticos</p>
        <div style="width: 300%; display: flex; justify-content: center;">
  <p style="color: rgb(206, 214, 200); font-weight: bold; font-size: 1.1rem; margin: 0;">
    Creador: Carlos Escobar 
  </p>
</div>
</div>
<div class="nav-buttons-container">
  <div class="nav-buttons">
    <button id="btn-registrar">Nuevo Registro</button>
    <button id="btn-buscar">Buscar</button>
    <button id="btn-logout" class="logout-btn">Cerrar Sesión</button>
  </div>
</div>

    </header>


    <div class="stats-container">
      <div class="stat-card" onclick="verTodosLosRegistros()">
        <h3>Total Registros</h3>
        <p id="total">0</p>
      </div>
      <div class="stat-card" onclick="verPendientes()">
        <h3>Pendientes</h3>
        <p id="pendientes">0</p>
      </div>
      <div class="stat-card" onclick="verEnProgreso()">
        <h3>En Progreso</h3>
        <p id="en-progreso">0</p>
      </div>
     <div class="stat-card" onclick="verFinalizados()">
        <h3>Finalizados</h3>
        <p id="finalizados">0</p>
      </div>
    </div>

    <!-- Sección de Registro -->
    <section id="registrar">
      <h2>Registrar Nuevo Mantenimiento</h2>
      <form id="form-registro">
        <div class="form-grid">
          <div class="form-group">
            
  <label for="tipo">Tipo de Equipo</label>
  <select id="tipo" required></select>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const selectTipo = document.getElementById('tipo');
  if (!selectTipo) return;

  fetch('http://10.110.6.148/mantenimiento/listar_tipo_equipo.php')
    .then(res => res.json())
    .then(data => {
      selectTipo.innerHTML = '';

      const placeholder = document.createElement('option');
      placeholder.value = '';
      placeholder.textContent = 'Seleccionar...';
      placeholder.disabled = true;
      placeholder.selected = true;
      selectTipo.appendChild(placeholder);

      data.forEach(tipo => {
        const option = document.createElement('option');
        option.value = tipo;
        option.textContent = tipo;
        selectTipo.appendChild(option);
      });

      new Choices(selectTipo, {
        placeholderValue: 'Seleccionar...',
        searchPlaceholderValue: 'Buscar o escribir...',
        searchEnabled: true,
        removeItemButton: true,
        addItems: true,
        duplicateItemsAllowed: false,
        editItems: true,
        addItemFilter: () => true,
        addItemText: (value) => `Usar: "${value}"`,
        noResultsText: 'No encontrado',
        noChoicesText: 'Sin opciones',
        shouldSort: false
      });
    })
    .catch(err => {
      console.error('❌ Error al cargar tipos de equipo:', err);
    });
});
</script>

</script>
            <div class="form-group">
  <label for="placa">Placa/Identificacion</label>
  <input type="text" id="placa" required>
</div>
<div class="form-group">
  <label for="marca">Marca</label>
  <select id="marca" required></select>
</div>

<script>
const selectMarca = document.getElementById('marca');
if (selectMarca) {
  fetch('http://10.110.6.148/mantenimiento/listar_marcas.php')
    .then(res => res.json())
    .then(data => {
      selectMarca.innerHTML = '';

      const placeholder = document.createElement('option');
      placeholder.value = '';
      placeholder.textContent = 'Seleccionar...';
      placeholder.disabled = true;
      placeholder.selected = true;
      selectMarca.appendChild(placeholder);

      data.forEach(marca => {
        const option = document.createElement('option');
        option.value = marca;
        option.textContent = marca;
        selectMarca.appendChild(option);
      });

      new Choices(selectMarca, {
        placeholderValue: 'Seleccionar...',
        searchPlaceholderValue: 'Buscar o escribir...',
        searchEnabled: true,
        removeItemButton: true,
        addItems: true,
        duplicateItemsAllowed: false,
        editItems: true,
        addItemFilter: () => true,
        addItemText: (value) => `Usar: "${value}"`,
        noResultsText: 'No encontrado',
        noChoicesText: 'Sin opciones',
        shouldSort: false
      });
    })
    .catch(err => {
      console.error('❌ Error al cargar marcas:', err);
    });
}

</script>

<div class="form-group">
  <label for="modelo">Modelo</label>
  <select id="modelo" required></select>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const modelos = [
      "E14", "OPTIPLEX","Thinkcentre M", "V50S", "M705", "R2", "BD506", "DEP-250", "v14","L390", "RB750",
      "DEP-450", "G6010", "ProBook", "Latitude", "1kva", "2kva", "3kva",
      "M428fdw", "M130fw", "M426fdw", "M428","402","BD507","V330-20ICB AIO","3200","Aruba","43809",
      "TL-SG1008D", "Otro..."
    ];

    const selectModelo = document.getElementById('modelo');
    if (!selectModelo) return;

    selectModelo.innerHTML = '';
    const placeholder = document.createElement('option');
    placeholder.value = '';
    placeholder.textContent = 'Seleccionar...';
    placeholder.disabled = true;
    placeholder.selected = true;
    selectModelo.appendChild(placeholder);

    modelos.forEach(modelo => {
      const option = document.createElement('option');
      option.value = modelo;
      option.textContent = modelo;
      selectModelo.appendChild(option);
    });

    new Choices(selectModelo, {
      placeholderValue: 'Seleccionar...',
      searchPlaceholderValue: 'Buscar o escribir...',
      searchEnabled: true,
      removeItemButton: true,
      addItems: true,
      duplicateItemsAllowed: false,
      editItems: true,
      addItemFilter: () => true,
      addItemText: (value) => `Usar: "${value}"`,
      noResultsText: 'No encontrado',
      noChoicesText: 'Sin opciones',
      shouldSort: false
    });
  });
  </script>


</select>
          </div>
          <div class="form-group">
            <label for="serial">Número de Serie</label>
            <input type="text" id="serial" required>
          </div>
          <div class="form-group">
            <label for="fecha">Fecha</label>
            <input type="date" id="fecha" required>
          </div>
          <div class="form-group">
            <label for="tecnico">Técnico Responsable</label>
           <select id="tecnico" required>
  <option value="">Seleccionar...</option>
  <option value="Wuilmer Andres Roman">Wuilmer Andres Roman </option>
  <option value="Maicol Esteban Cardenas">Maicol Esteban Cardenas</option>
  <option value="Johel Fernando Garnica">Johel Fernando Garnica </option>
  <option value="Jesus Ricardo">Jesus Ricardo </option>
   <option value="Pasante 1 Infraestructura">Pasante 1 Infraestructura </option>
   <option value="Pasante 2 Comunicaciones">Pasante 2 Comunicaciones </option>
</select>
          </div>
          <div class="form-group">
            <label for="tipo-mantenimiento">Tipo de Mantenimiento</label>
            <select id="tipo-mantenimiento" required>
              <option value="">Seleccionar...</option>
              <option value="Preventivo">Preventivo</option>
              <option value="Correctivo">Correctivo</option>
              <option value="Preventivo">Preventivo / Correctivo</option>
            </select>
          </div>
          <div class="form-group">
            <label for="estado">Estado</label>
            <select id="estado" required>
              <option value="">Seleccionar...</option>
              <option value="Pendiente">Pendiente</option>
              <option value="En progreso">En progreso</option>
              <option value="Finalizado">Finalizado</option>
            </select>
          </div>
          <div class="form-group">

<label for="ubicacion">Ubicación</label>
<select id="ubicacion" name="ubicacion" required></select>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const ubicaciones = [
   "Admin Fincas","Oficinas Auteco", "Gestión Humana", "Tecnología", "Mantenimiento", "Agricultura FZ","Santa Clara", "Taller",
    "Logística", "Porcicultura", "Bioprocesos", "Proyectos", "Planta Extractora",
    "Planta Balanceados FZ", "Planta Balanceados BARL", "Planta Secamiento FZ",
     "Planta Secamiento BARL","Taller SF","Agricultura SF","Agricultura SC",
     "Ganderia","Calidad","Obra Civil","Salud Integral","Control Interno","Fundacion Pervivir","PLanta Semilla","Otro.."
  ];

  const select = document.getElementById('ubicacion');
  if (!select) return;

  select.innerHTML = '';
  const placeholder = document.createElement('option');
  placeholder.value = '';
  placeholder.textContent = 'Seleccionar...';
  placeholder.disabled = true;
  placeholder.selected = true;
  select.appendChild(placeholder);

  ubicaciones.forEach(u => {
    const option = document.createElement('option');
    option.value = u;
    option.textContent = u;
    select.appendChild(option);
  });

  new Choices(select, {
    placeholderValue: 'Seleccionar...',
    searchPlaceholderValue: 'Buscar o escribir...',
    searchEnabled: true,
    removeItemButton: true,
    addItems: true,
    duplicateItemsAllowed: false,
    editItems: true,
    addItemFilter: () => true,
    addItemText: (value) => `Usar: "${value}"`,
    noResultsText: 'No encontrado',
    noChoicesText: 'Sin opciones',
    shouldSort: false
  });
});
</script>

          </div>
          <div class="form-group">
            <label for="centro-costo">Centro de Costo</label>
            <input type="text" id="centro-costo" required>
          </div>
          <div class="form-group">
            <label for="url-ticket">URL del Ticket (opcional)</label>
            <input type="url" id="url-ticket">
          </div>
        </div>
        <div class="form-group">
          <label for="observaciones">Observaciones</label>
          <textarea id="observaciones"></textarea>
        </div>
        <div class="form-actions">
          <button type="submit">Guardar Registro</button>
        </div>
      </form>

      <!-- Lista de registros -->
      <ul id="lista" style="margin-top: 2rem;"></ul>
    </section>

    <!-- Sección de Búsqueda -->
    <section id="buscar">
      <h2>Buscar Mantenimientos</h2>
      <div class="search-controls">
        <input type="text" id="buscar-input" placeholder="Buscar por placa, serial o técnico...">
        <button id="btn-ejecutar-busqueda">Buscar Registro</button>
        <button id="exportar-excel">Exportar a Excel</button>
      </div>
      <div class="date-filters">
        <label>
          Desde:
          <input type="date" id="filtro-desde">
        </label>
        <label>
          Hasta:
          <input type="date" id="filtro-hasta">
        </label>
        <button id="filtrar-fechas">Filtrar</button>
      </div>
      <ul id="resultados" style="margin-top: 1.5rem;"></ul>
    </section>
  </div>

  <!-- Modal de Edición -->
  <div class="modal" id="modal-edicion">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3>Editar Mantenimiento</h3>
      <form id="form-edicion">
        <div class="form-grid">
          <div class="form-group">
            <label for="edit-tipo">Tipo de Equipo</label>
       <select id="edit-tipo" required></select>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tiposEquipo = [
    "Computador portátil", "Computador de escritorio", "Impresora",
    "Teléfono IP", "Tablet", "Radio de comunicación", "Router / Switch",
    "Cámara de seguridad", "Proyector","Ups","AP","Terminal","Terminal Facial",
    "Nvr","Servidores","Rack de comunicaciones","Radio","VideoCoferencia", "Otro..."
  ];

  const select = document.getElementById('edit-tipo');
  if (!select) return;

  select.innerHTML = '';
  const placeholder = document.createElement('option');
  placeholder.value = '';
  placeholder.textContent = 'Seleccionar...';
  placeholder.disabled = true;
  placeholder.selected = true;
  select.appendChild(placeholder);

  tiposEquipo.forEach(item => {
    const option = document.createElement('option');
    option.value = item;
    option.textContent = item;
    select.appendChild(option);
  });

  new Choices(select, {
    placeholderValue: 'Seleccionar...',
    searchPlaceholderValue: 'Buscar o escribir...',
    searchEnabled: true,
    removeItemButton: true,
    addItems: true,
    duplicateItemsAllowed: false,
    editItems: true,
    addItemFilter: () => true,
    addItemText: (value) => `Usar: "${value}"`,
    noResultsText: 'No encontrado',
    noChoicesText: 'Sin opciones',
    shouldSort: false
  });
});
</script>

          </div>
          <div class="form-group">
            <label for="edit-placa">Placa/Identificación</label>
            <input type="text" id="edit-placa" required>
          </div>
          <div class="form-group">
            <label for="edit-marca">Marca</label>
            <select id="edit-marca" required></select>
            </div>
               <div class="form-group">
            <label for="edit-modelo">Modelo</label>
            <select id="edit-modelo" required></select>
            </div>

            <script> 
document.addEventListener('DOMContentLoaded', () => {
  const modelos = [
    "E14", "OPTIPLEX","Thinkcentre M", "V50S", "M705", "R2", "BD506", "DEP-250", "v14", "L390","RB750",
    "DEP-450", "G6010", "ProBook", "Latitude", "1kva", "2kva", "3kva",
    "M428fdw", "M130fw", "M426fdw", "M428","402","BD507","V330-20ICB AIO","3200","Aruba","43809",
    "TL-SG1008D", "Otro..."
  ];

  const selectModelo = document.getElementById('edit-modelo');
  if (!selectModelo) return;

  selectModelo.innerHTML = '';
  const placeholder = document.createElement('option');
  placeholder.value = '';
  placeholder.textContent = 'Seleccionar...';
  placeholder.disabled = true;
  placeholder.selected = true;
  selectModelo.appendChild(placeholder);

  modelos.forEach(modelo => {
    const option = document.createElement('option');
    option.value = modelo;
    option.textContent = modelo;
    selectModelo.appendChild(option);
  });

  new Choices(selectModelo, {
    placeholderValue: 'Seleccionar...',
    searchPlaceholderValue: 'Buscar o escribir...',
    searchEnabled: true,
    removeItemButton: true,
    addItems: true,
    duplicateItemsAllowed: false,
    editItems: true,
    addItemFilter: () => true,
    addItemText: (value) => `Usar: "${value}"`,
    noResultsText: 'No encontrado',
    noChoicesText: 'Sin opciones',
    shouldSort: false
  });
});
</script>

          <div class="form-group">
            <label for="edit-serial">Número de Serie</label>
            <input type="text" id="edit-serial" required>
          </div>
          <div class="form-group">
            <label for="edit-fecha">Fecha</label>
            <input type="date" id="edit-fecha" required>
          </div>
          <div class="form-group">
            <label for="edit-tecnico">Técnico Responsable</label>
            <select id="edit-tecnico" required></select>
          </div>
          <div class="form-group">
            <label for="edit-tipo-mantenimiento">Tipo de Mantenimiento</label>
            <select id="edit-tipo-mantenimiento" required>
              <option value="Preventivo">Preventivo</option>
              <option value="Correctivo">Correctivo</option>
            </select>
          </div>
          <div class="form-group">
            <label for="edit-estado">Estado</label>
            <select id="edit-estado" required>
              <option value="Pendiente">Pendiente</option>
              <option value="En progreso">En progreso</option>
              <option value="Finalizado">Finalizado</option>
            </select>
          </div>
          <div class="form-group">
            <label for="edit-ubicacion">Ubicación</label>
           <select id="edit-ubicacion" required></select>

           <script>
document.addEventListener('DOMContentLoaded', () => {
  const marcas = [
    "Hytera", "Motorola", "Lenovo","Dell","Lenovo Mesa","Epson","Mikrotik",
    "Canon", "HP", "Dell Latitude","Powest","Legrand","Unipower","Powest Titan",
    "Apc","Access Poin","Zebra","Hikvision","hikvision", "Ryotel","Hp Laser","ThinkPad",
    "TP-LINK","MINUTEMAN ","NUROUM","Samsung","Otro..."
  ];


  const select = document.getElementById('edit-marca');
  if (!select) return;

  select.innerHTML = '';
  const placeholder = document.createElement('option');
  placeholder.value = '';
  placeholder.textContent = 'Seleccionar...';
  placeholder.disabled = true;
  placeholder.selected = true;
  select.appendChild(placeholder);

  marcas.forEach(marca => {
    const option = document.createElement('option');
    option.value = marca;
    option.textContent = marca;
    select.appendChild(option);
  });

  new Choices(select, {
    placeholderValue: 'Seleccionar...',
    searchPlaceholderValue: 'Buscar o escribir...',
    searchEnabled: true,
    removeItemButton: true,
    addItems: true,
    duplicateItemsAllowed: false,
    editItems: true,
    addItemFilter: () => true,
    addItemText: (value) => `Usar: "${value}"`,
    noResultsText: 'No encontrado',
    noChoicesText: 'Sin opciones',
    shouldSort: false
  });
});
</script>



<script>
document.addEventListener('DOMContentLoaded', () => {
  const tecnicos = [
    "Wuilmer Andres Roman", "Maicol Esteban Cardenas",
    "Johel Fernando Garnica", "Jesus Ricardo",
    "Pasante 1 Infraestructura",
    "Pasante 2 Comunicaciones"
  ];

  const select = document.getElementById('edit-tecnico');
  if (!select) return;

  select.innerHTML = '';
  const placeholder = document.createElement('option');
  placeholder.value = '';
  placeholder.textContent = 'Seleccionar...';
  placeholder.disabled = true;
  placeholder.selected = true;
  select.appendChild(placeholder);

  tecnicos.forEach(nombre => {
    const option = document.createElement('option');
    option.value = nombre;
    option.textContent = nombre;
    select.appendChild(option);
  });

  new Choices(select, {
    placeholderValue: 'Seleccionar...',
    searchPlaceholderValue: 'Buscar o escribir...',
    searchEnabled: true,
    removeItemButton: true,
    addItems: true,
    duplicateItemsAllowed: false,
    editItems: true,
    addItemFilter: () => true,
    addItemText: (value) => `Usar: "${value}"`,
    noResultsText: 'No encontrado',
    noChoicesText: 'Sin opciones',
    shouldSort: false
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const ubicaciones = [
    "Admin Fincas","Oficinas Auteco", "Gestión Humana", "Tecnología", "Mantenimiento", "Agricultura FZ","Santa Clara", "Taller",
    "Logística", "Porcicultura", "Bioprocesos", "Proyectos", "Planta Extractora",
    "Planta Balanceados FZ", "Planta Balanceados BARL", "Planta Secamiento FZ",
     "Planta Secamiento BARL","Taller SF","Agricultura SF","Agricultura SC",
     "Ganderia","Calidad","Obra Civil","Salud Integral","Control Interno","Fundacion Pervivir","PLanta Semilla","Otra.."
  ];

  const select = document.getElementById('edit-ubicacion');
  if (!select) return;

  select.innerHTML = '';
  const placeholder = document.createElement('option');
  placeholder.value = '';
  placeholder.textContent = 'Seleccionar...';
  placeholder.disabled = true;
  placeholder.selected = true;
  select.appendChild(placeholder);

  ubicaciones.forEach(u => {
    const option = document.createElement('option');
    option.value = u;
    option.textContent = u;
    select.appendChild(option);
  });

  new Choices(select, {
    placeholderValue: 'Seleccionar...',
    searchPlaceholderValue: 'Buscar o escribir...',
    searchEnabled: true,
    removeItemButton: true,
    addItems: true,
    duplicateItemsAllowed: false,
    editItems: true,
    addItemFilter: () => true,
    addItemText: (value) => `Usar: "${value}"`,
    noResultsText: 'No encontrado',
    noChoicesText: 'Sin opciones',
    shouldSort: false
  });
});
</script>


          </div>
          <div class="form-group">
            <label for="edit-centro-costo">Centro de Costo</label>
            <input type="text" id="edit-centro-costo" required>
          </div>
          <div class="form-group">
            <label for="edit-url-ticket">URL del Ticket</label>
            <input type="url" id="edit-url-ticket">
          </div>
        </div>
        <div class="form-group">
          <label for="edit-observaciones">Observaciones</label>
          <textarea id="edit-observaciones"></textarea>
        </div>
        <input type="hidden" id="edit-indice">
        <div class="form-actions">
          <button type="submit">Guardar Cambios</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Script principal -->
  <script>


  // Variables de estado
  let registros = [];
  let currentSection = 'registrar';

  // Elementos del DOM
  const loginContainer = document.getElementById('login');
  const appContainer = document.getElementById('app');
  const loginForm = document.getElementById('login-form');
  const errorLogin = document.getElementById('error-login');
  const btnRegistrar = document.getElementById('btn-registrar');
  const btnBuscar = document.getElementById('btn-buscar');
  const btnLogout = document.getElementById('btn-logout');
  const registrarSection = document.getElementById('registrar');
  const buscarSection = document.getElementById('buscar');
  const formRegistro = document.getElementById('form-registro');
  const listaRegistros = document.getElementById('lista');
  const buscarInput = document.getElementById('buscar-input');
  const resultadosBusqueda = document.getElementById('resultados');
  const exportarExcelBtn = document.getElementById('exportar-excel');
  const modalEdicion = document.getElementById('modal-edicion');
  const formEdicion = document.getElementById('form-edicion');
  const closeModal = document.querySelector('.close-modal');
  const totalElement = document.getElementById('total');
  const pendientesElement = document.getElementById('pendientes');
  const enProgresoElement = document.getElementById('en-progreso');
  const finalizadosElement = document.getElementById('finalizados');
  const videoFondo = document.getElementById('video-fondo');

  function sincronizarRegistros() {
    
  fetch(API_BASE + "obtener_registros.php")
  .then(res => res.json())
  .then(data => {
    registros = data;
    if (currentSection === 'registrar') {
      renderizarRegistros();
    } else {
      buscarRegistros();
    }
    actualizarEstadisticas();
  })
  .catch(err => {
    console.error("Error al sincronizar registros:", err);
    alert("❌ Error al conectar con la base de datos");
  });

}
    // Inicialización
   document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('btn-ejecutar-busqueda').addEventListener('click', () => {
    buscarRegistros();
  });

  


  // Mostrar video al inicio
  videoFondo.style.display = 'block';

  
  const isLoggedIn = sessionStorage.getItem('isLoggedIn');
if (isLoggedIn === 'true') {
  videoFondo.style.display = 'none';
  loginContainer.style.display = 'none';
  appContainer.style.display = 'block';

  sincronizarRegistros(); // Primera sincronización al cargar
}


  const today = new Date().toISOString().split('T')[0];
  document.getElementById('fecha').value = today;
  document.getElementById('filtro-desde').value = today;
  document.getElementById('filtro-hasta').value = today;

  // ✅ Sincronizar cada 30 segundos
  setInterval(sincronizarRegistros, 30000);
});
document.getElementById('filtrar-fechas').addEventListener('click', () => {
  aplicarFiltroFecha = true;
  buscarRegistros();
});

    // Event Listeners
    loginForm.addEventListener('submit', handleLogin);
    btnRegistrar.addEventListener('click', () => cambiarSeccion('registrar'));
    btnBuscar.addEventListener('click', () => cambiarSeccion('buscar'));
    btnLogout.addEventListener('click', handleLogout);
    formRegistro.addEventListener('submit', agregarRegistro);
    buscarInput.addEventListener('input', buscarRegistros);
    exportarExcelBtn.addEventListener('click', exportarAExcel);
    formEdicion.addEventListener('submit', guardarEdicion);
    closeModal.addEventListener('click', cerrarModal);

    // Funciones
const API_BASE = "http://10.110.6.148/mantenimiento/";

  function handleLogin(e) {
  e.preventDefault();
  const usuario = document.getElementById('usuario').value;
  const clave = document.getElementById('clave').value;

  fetch("http://10.110.6.148/mantenimiento/validar_login.php", {

    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ usuario, clave })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      sessionStorage.setItem('isLoggedIn', 'true');
      loginContainer.style.display = 'none';
      appContainer.style.display = 'block';
      videoFondo.style.display = 'none';
      sincronizarRegistros();
    } else {
  errorLogin.textContent = data.error || "Usuario o contraseña no válidos. Por favor, verifique sus datos";

  // Mostrar animación
  errorLogin.classList.remove('oculto');
  errorLogin.classList.add('visible');

  // Ocultar después de 5 segundos
  setTimeout(() => {
    errorLogin.classList.remove('visible');
    setTimeout(() => {
      errorLogin.classList.add('oculto');
    }, 500); // espera a que termine la transición
  }, 5000);
}


  })
  .catch(err => {
    console.error("Error en login:", err);
    errorLogin.textContent = "❌Error al conectar con el servidor";
  });
}

    function handleLogout() {
  videoFondo.style.display = 'block';
  sessionStorage.removeItem('isLoggedIn'); 
  loginContainer.style.display = 'flex';
  appContainer.style.display = 'none';
  document.getElementById('usuario').value = '';
  document.getElementById('clave').value = '';
  errorLogin.textContent = '';
}


    function cambiarSeccion(seccion) {
      if (seccion === currentSection) return;

      if (seccion === 'registrar') {
        registrarSection.style.display = 'block';
        buscarSection.style.display = 'none';
        currentSection = 'registrar';
      } else if (seccion === 'buscar') {
        registrarSection.style.display = 'none';
        buscarSection.style.display = 'block';
        buscarRegistros();
        currentSection = 'buscar';
      }
    }
function agregarRegistro(e) {
  e.preventDefault();

  const nuevoRegistro = {
    id: Date.now().toString(),
    tipo: document.getElementById('tipo').value,
    placa: document.getElementById('placa').value,
    marca: document.getElementById('marca').value,
    modelo: document.getElementById('modelo').value,
    serial: document.getElementById('serial').value,
    fecha: document.getElementById('fecha').value,
    tecnico: document.getElementById('tecnico').value,
    tipoMantenimiento: document.getElementById('tipo-mantenimiento').value,
    estado: document.getElementById('estado').value,
    ubicacion: document.getElementById('ubicacion').value,
    centroCosto: document.getElementById('centro-costo').value,
    urlTicket: document.getElementById('url-ticket').value,
    observaciones: document.getElementById('observaciones').value,
    fechaRegistro: new Date().toISOString(),
    usuarioRegistro: document.getElementById('usuario').value || 'tecnico'
  };

 fetch(API_BASE + "guardar_registro.php", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(nuevoRegistro)
})
  .then(res => res.json())
  .then(data => {
    console.log("Respuesta del servidor:", data);
    if (data.success) {
      alert(" " + (data.mensaje || "Guardado correctamente"));
      formRegistro.reset();
      document.getElementById('fecha').value = new Date().toISOString().split('T')[0];
      setTimeout(sincronizarRegistros, 2000);
    } else {
      alert("❌ Error: " + (data.error || "Respuesta inesperada del servidor"));
    }
  })
  .catch(err => {
    console.error("Error:", err);
    alert("❌ Error al guardar el registro");
  });


    }

    function renderizarRegistros() {
      listaRegistros.innerHTML = '';
      
      if (registros.length === 0) {
        listaRegistros.innerHTML = '<p style="text-align: center; color: #666;">No hay registros de mantenimiento</p>';
        return;
      }

      registros.forEach((registro) => {
        const li = document.createElement('li');
        li.className = 'registro-item';
        
        let statusClass = '';
        if (registro.estado === 'Pendiente') statusClass = 'status-pendiente';
        if (registro.estado === 'En progreso') statusClass = 'status-progreso';
        if (registro.estado === 'Finalizado') statusClass = 'status-finalizado';

        li.innerHTML = `
          <div class="registro-header">
            <div class="registro-title">${registro.tipo} - ${registro.placa}</div>
            <div class="registro-actions">
              <span class="status-badge ${statusClass}">${registro.estado}</span>
              <button class="edit-btn" data-id="${registro.id}">Editar</button>
              <button class="delete-btn" data-id="${registro.id}">Eliminar</button>
            </div>
          </div>
          <div class="registro-details">
            <div class="detail-item">
              <div class="detail-label">Tipo de Equipo</div>
              <div class="detail-value">${registro.tipo}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Marca</div>
              <div class="detail-value">${registro.marca}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Modelo</div>
              <div class="detail-value">${registro.modelo}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Serial</div>
              <div class="detail-value">${registro.serial}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Fecha</div>
              <div class="detail-value">${formatDate(registro.fecha)}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Placa/Identificacion</div>
              <div class="detail-value">${registro.placa}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Técnico</div>
              <div class="detail-value">${registro.tecnico}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Tipo Mant.</div>
              <div class="detail-value">${registro.tipoMantenimiento}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Ubicación</div>
              <div class="detail-value">${registro.ubicacion}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Centro Costo</div>
              <div class="detail-value">${registro.centroCosto}</div>
            </div>
           ${registro.urlTicket && registro.urlTicket.trim() !== '' ? `
  <div class="detail-item">
    <div class="detail-label">Ticket</div>
    <div class="detail-value"><a href="${registro.urlTicket}" target="_blank">📎Ver ticket</a></div>
  </div>` : ''}
            <div class="detail-item">
              <div class="detail-label">Registrado por</div>
              <div class="detail-value">${registro.usuarioRegistro || 'Sistema'}</div>
            </div>
          </div>
          ${registro.observaciones ? `
          <div class="detail-item" style="margin-top: 1rem;">
            <div class="detail-label">Observaciones</div>
            <div class="detail-value">${registro.observaciones}</div>
          </div>` : ''}
        `;
        
        listaRegistros.appendChild(li);
      });

      // Agregar event listeners a los botones de editar y eliminar
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.target.getAttribute('data-id');
          editarRegistro(id);
        });
      });

   document.querySelectorAll('.delete-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    eliminarRegistro(id);
  });
});

    }

    function buscarRegistros() {
     if (modoPendientes) {
  modoPendientes = false;
}

      const termino = buscarInput.value.toLowerCase();
      const desde = document.getElementById('filtro-desde').value;
      const hasta = document.getElementById('filtro-hasta').value;
      function exportarAExcel() {
  const resultados = document.querySelectorAll('#resultados .registro-item');
  if (resultados.length === 0) {
    alert('No hay resultados de búsqueda para exportar.');
    return;
  }

  const datosExportar = [];

  resultados.forEach(item => {
    const fila = {
      'Tipo de Equipo': '',
      'Placa': '',
      'Marca': '',
      'Modelo': '',
      'Serial': '',
      'Fecha': '',
      'Técnico': '',
      'Estado': '',
      'Ubicación': '',
      'Centro de Costo': '',
      'Observaciones': '',
      'Ticket': '',
      'Registrado por': ''
    };

    const detalles = item.querySelectorAll('.detail-item');
    detalles.forEach(detalle => {
      const label = detalle.querySelector('.detail-label')?.textContent.trim().toLowerCase();
      const valor = detalle.querySelector('.detail-value')?.textContent.trim();

      if (!label) return;

      if (label.includes('tipo de equipo')) fila['Tipo de Equipo'] = valor;
      else if (label.includes('placa')) fila['Placa'] = valor;
      else if (label.includes('marca')) fila['Marca'] = valor;
      else if (label.includes('modelo')) fila['Modelo'] = valor;
      else if (label.includes('serial')) fila['Serial'] = valor;
      else if (label.includes('fecha')) fila['Fecha'] = valor;
      else if (label.includes('técnico')) fila['Técnico'] = valor;
      else if (label.includes('ubicación')) fila['Ubicación'] = valor;
      else if (label.includes('centro')) fila['Centro de Costo'] = valor;
      else if (label.includes('observaciones')) fila['Observaciones'] = valor;
      else if (label.includes('ticket')) fila['Ticket'] = valor;
      else if (label.includes('registrado')) fila['Registrado por'] = valor;
    });

    // Obtener estado directamente desde la clase
    fila['Estado'] = item.querySelector('.status-badge')?.textContent.trim() || '';

    datosExportar.push(fila);
  });

  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.json_to_sheet(datosExportar);
  XLSX.utils.book_append_sheet(wb, ws, 'Resultados');

  const fechaActual = new Date().toISOString().split('T')[0];
  XLSX.writeFile(wb, `resultados_busqueda_${fechaActual}.xlsx`);
}

      resultadosBusqueda.innerHTML = '';
      let resultados = registros.filter(registro => {
  const coincideTexto = 
    registro.placa.toLowerCase().includes(termino) || 
    registro.serial.toLowerCase().includes(termino) || 
    registro.tecnico.toLowerCase().includes(termino) ||
    (registro.usuarioRegistro && registro.usuarioRegistro.toLowerCase().includes(termino));

  if (!aplicarFiltroFecha || (!desde && !hasta)) {
    return coincideTexto;
  }

  const fechaRegistro = new Date(registro.fecha);
  const fechaDesde = new Date(desde);
  const fechaHasta = new Date(hasta);
  fechaHasta.setDate(fechaHasta.getDate() + 1); // incluir todo el día

  const coincideFecha = fechaRegistro >= fechaDesde && fechaRegistro <= fechaHasta;
  return coincideTexto && coincideFecha;
});
aplicarFiltroFecha = false;

      
      if (resultados.length === 0) {
        resultadosBusqueda.innerHTML = '<p style="text-align: center; color: #666;">No se encontraron resultados</p>';
        return;
      }
      function filtrarPorFechas() {
  const desde = document.getElementById('filtro-desde').value;
  const hasta = document.getElementById('filtro-hasta').value;

  if (!desde || !hasta) {
    alert("⚠️ Por favor selecciona un rango de fechas válido.");
    return;
  }

  const termino = buscarInput.value.toLowerCase();

  const fechaDesde = new Date(desde);
  const fechaHasta = new Date(hasta);
  fechaHasta.setDate(fechaHasta.getDate() + 1); // incluir todo el día

  const resultados = registros.filter(registro => {
    const coincideTexto =
      registro.placa.toLowerCase().includes(termino) ||
      registro.serial.toLowerCase().includes(termino) ||
      registro.tecnico.toLowerCase().includes(termino) ||
      (registro.usuarioRegistro && registro.usuarioRegistro.toLowerCase().includes(termino));

    const fechaRegistro = new Date(registro.fecha);
    const coincideFecha = fechaRegistro >= fechaDesde && fechaRegistro <= fechaHasta;

    return coincideTexto && coincideFecha;
  });

  renderizarResultadosBusqueda(resultados);
}

      
      resultados.forEach(registro => {
        const li = document.createElement('li');
        li.className = 'registro-item';
        
        let statusClass = '';
        if (registro.estado === 'Pendiente') statusClass = 'status-pendiente';
        if (registro.estado === 'En progreso') statusClass = 'status-progreso';
        if (registro.estado === 'Finalizado') statusClass = 'status-finalizado';

        li.innerHTML = `
          <div class="registro-header">
            <div class="registro-title">${registro.tipo} - ${registro.placa}</div>
            <div class="registro-actions">
              <span class="status-badge ${statusClass}">${registro.estado}</span>
              <button class="edit-btn" data-id="${registro.id}">Editar</button>
              <button class="delete-btn" data-id="${registro.id}">Eliminar</button>
              <button class="history-btn" data-id="${registro.id}">Ver Historial</button>
            </div>
          </div>
          <div class="registro-details">
            <div class="detail-item">
              <div class="detail-label">Tipo de Equipo</div>
              <div class="detail-value">${registro.tipo}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Marca</div>
              <div class="detail-value">${registro.marca}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Modelo</div>
              <div class="detail-value">${registro.modelo}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Placa/Identificacion</div>
              <div class="detail-value">${registro.placa}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Serial</div>
              <div class="detail-value">${registro.serial}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Fecha</div>
              <div class="detail-value">${formatDate(registro.fecha)}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Técnico</div>
              <div class="detail-value">${registro.tecnico}</div>
             </div> 
        <div class="detail-item">
          <div class="detail-label">Ubicación</div>
          <div class="detail-value">${registro.ubicacion}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">Centro de Costo</div>
          <div class="detail-value">${registro.centroCosto}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">Observaciones</div>
          <div class="detail-value">${registro.observaciones || ''}</div>
        </div>
        ${registro.urlTicket ? `<div class="detail-item">
  <div class="detail-label">Ticket</div>
  <div class="detail-value"><a href="${registro.urlTicket}" target="_blank">📎Ver ticket</a></div>
</div>` : ''}
            <div class="detail-item">
              <div class="detail-label">Registrado por</div>
              <div class="detail-value">${registro.usuarioRegistro || 'Sistema'}</div>
            </div>
          </div>
        `;
        
        resultadosBusqueda.appendChild(li);
      });
   document.querySelectorAll('.history-btn').forEach(btn => {
     btn.addEventListener('click', (e) => {
      const id = e.target.getAttribute('data-id');
       verHistorial(id);
  });
});
      // Agregar event listeners a los botones de editar
       document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.target.getAttribute('data-id');
          editarRegistro(id);
        });
      });
      document.querySelectorAll('.delete-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    eliminarRegistro(id);
  });
});

    }

    function editarRegistro(id) {
  const registro = registros.find(r => r.id === id);
  if (!registro) return;

  // Campos normales
  document.getElementById('edit-placa').value = registro.placa;
  document.getElementById('edit-serial').value = registro.serial;
  document.getElementById('edit-fecha').value = registro.fecha;
  document.getElementById('edit-tipo-mantenimiento').value = registro.tipoMantenimiento;
  document.getElementById('edit-estado').value = registro.estado;
  document.getElementById('edit-centro-costo').value = registro.centroCosto;
  document.getElementById('edit-url-ticket').value = registro.urlTicket || '';
  document.getElementById('edit-observaciones').value = registro.observaciones || '';
  document.getElementById('edit-indice').value = registros.findIndex(r => r.id === id);

  // Campos <select> con Choices.js
  setChoiceValue('edit-tipo', registro.tipo);
  setChoiceValue('edit-marca', registro.marca);
  setChoiceValue('edit-modelo', registro.modelo);
  setChoiceValue('edit-tecnico', registro.tecnico);
  setChoiceValue('edit-ubicacion', registro.ubicacion);

  modalEdicion.classList.add('active');
}


    function guardarEdicion(e) {
  e.preventDefault();

  const indice = document.getElementById('edit-indice').value;
  if (indice === '' || indice < 0 || indice >= registros.length) return;

  const registroEditado = {
    id: registros[indice].id,
    tipo: document.getElementById('edit-tipo').value,
    placa: document.getElementById('edit-placa').value,
    marca: document.getElementById('edit-marca').value,
    modelo: document.getElementById('edit-modelo').value,
    serial: document.getElementById('edit-serial').value,
    fecha: document.getElementById('edit-fecha').value,
    tecnico: document.getElementById('edit-tecnico').value,
    tipoMantenimiento: document.getElementById('edit-tipo-mantenimiento').value,
    estado: document.getElementById('edit-estado').value,
    ubicacion: document.getElementById('edit-ubicacion').value,
    centroCosto: document.getElementById('edit-centro-costo').value,
    urlTicket: document.getElementById('edit-url-ticket').value,
    observaciones: document.getElementById('edit-observaciones').value
  };

 fetch(API_BASE + "editar_registro.php", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(registroEditado)
})
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert(data.mensaje || "✅ Registro actualizado correctamente");
      cerrarModal();
      sincronizarRegistros();
    } else {
      alert("❌ Error: " + (data.error || "No se pudo actualizar"));
    }
  })
  .catch(err => {
    console.error("Error al actualizar:", err);
    alert("❌ Error al actualizar el registro");
  });

}
function setChoiceValue(selectId, value) {
  const select = document.getElementById(selectId);
  if (!select) return;

  const choiceInstance = select.choicesInstance || select._choices || (Choices.instances || []).find(c => c.passedElement.element.id === selectId);

  if (choiceInstance) {
    choiceInstance.removeActiveItems();     
    choiceInstance.setChoiceByValue(value);   
  } else {
    select.value = value; 
  }
}


function eliminarRegistro(id) {
  if (!confirm('¿Estás seguro de eliminar este registro?')) return;

 fetch(API_BASE + "eliminar_registro.php", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ id })
})
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert(data.mensaje || "✅ Registro eliminado correctamente");
      sincronizarRegistros();
    } else {
      alert("❌ Error: " + (data.error || "No se pudo eliminar"));
    }
  })
  .catch(err => {
    console.error("Error al eliminar:", err);
    alert("❌ Error al eliminar el registro");
  });

}


    function cerrarModal() {
      modalEdicion.classList.remove('active');
    }

    function actualizarEstadisticas() {
      totalElement.textContent = registros.length;
      pendientesElement.textContent = registros.filter(r => r.estado === 'Pendiente').length;
      enProgresoElement.textContent = registros.filter(r => r.estado === 'En progreso').length;
      finalizadosElement.textContent = registros.filter(r => r.estado === 'Finalizado').length;
    }
  
    function formatDate(dateString) {
      const options = { year: 'numeric', month: 'short', day: 'numeric' };
      return new Date(dateString).toLocaleDateString('es-ES', options);
    }

    function exportarAExcel() {
  const resultados = document.querySelectorAll('#resultados .registro-item');
  if (resultados.length === 0) {
    alert('No hay resultados de búsqueda para exportar.');
    return;
  }

  const datosExportar = [];

  resultados.forEach(item => {
    const fila = {
      'Tipo de Equipo': '',
      'Placa': '',
      'Marca': '',
      'Modelo': '',
      'Serial': '',
      'Fecha': '',
      'Técnico': '',
      'Tipo de Mantenimiento': '',
      'Estado': '',
      'Ubicación': '',
      'Centro de Costo': '',
      'Observaciones': '',
      'Ticket': '',
      'Registrado por': ''
    };

    const detalles = item.querySelectorAll('.detail-item');
    detalles.forEach(detalle => {
      const label = detalle.querySelector('.detail-label')?.textContent.trim().toLowerCase();
      const valor = detalle.querySelector('.detail-value')?.textContent.trim();

      if (!label) return;

      if (label.includes('tipo de equipo')) fila['Tipo de Equipo'] = valor;
      else if (label.includes('placa')) fila['Placa'] = valor;
      else if (label.includes('marca') && !label.includes('marca/modelo')) fila['Marca'] = valor;
      else if (label.includes('modelo')) fila['Modelo'] = valor;
      else if (label.includes('serial')) fila['Serial'] = valor;
      else if (label.includes('fecha')) fila['Fecha'] = valor;
      else if (label.includes('técnico')) fila['Técnico'] = valor;
      else if (label.includes('tipo mant')) fila['Tipo de Mantenimiento'] = valor;
      else if (label.includes('ubicación')) fila['Ubicación'] = valor;
      else if (label.includes('centro')) fila['Centro de Costo'] = valor;
      else if (label.includes('observaciones')) fila['Observaciones'] = valor;
      else if (label.includes('ticket')) {
        const link = detalle.querySelector('a');
        fila['Ticket'] = link ? link.href : valor;
      }
      else if (label.includes('registrado')) fila['Registrado por'] = valor;
    });

    fila['Estado'] = item.querySelector('.status-badge')?.textContent.trim() || '';
    datosExportar.push(fila);
  });

  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.json_to_sheet(datosExportar);
  XLSX.utils.book_append_sheet(wb, ws, 'Resultados');

  const fechaActual = new Date().toISOString().split('T')[0];
  XLSX.writeFile(wb, `resultados_busqueda_${fechaActual}.xlsx`);
}


    window.addEventListener('click', (e) => {
      if (e.target === modalEdicion) {
        cerrarModal();
      }
    });

      function verHistorial(id) {
  const registro = registros.find(r => r.id === id);
  if (!registro) return;

  alert(`Historial del equipo con placa: ${registro.placa}`);
 
  
  const placaBuscada = registro.placa;
  const historiales = registros
    .filter(r => r.placa === placaBuscada)
    .sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

  const contenedor = document.getElementById('historial-contenido');
  contenedor.innerHTML = '';

  if (historiales.length === 0) {
    contenedor.innerHTML = '<p style="color: #666;">No hay mantenimientos anteriores para esta placa.</p>';
  } else {

// Aquí esta las funciones que hace que quede horizonta y en forma
    historiales.forEach(item => {
      const statusClass =
        item.estado === 'Pendiente' ? 'status-pendiente' :
        item.estado === 'En progreso' ? 'status-progreso' :
        item.estado === 'Finalizado' ? 'status-finalizado' : '';

      const div = document.createElement('div');
      div.className = 'registro-item';
      div.innerHTML = `
        <div class="registro-header">
          <div class="registro-title">${item.tipo} - ${item.placa}</div>
          <div class="registro-actions">
            <span class="status-badge ${statusClass}">${item.estado}</span>
          </div>
        </div>
        <div class="registro-details">
          <div class="detail-item">
            <div class="detail-label">Tipo de Equipo</div>
            <div class="detail-value">${item.tipo}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Marca</div>
            <div class="detail-value">${item.marca}</div>
          </div>
          <div class="detail-item">
              <div class="detail-label">Modelo</div>
              <div class="detail-value">${registro.modelo}</div>
            </div>
          <div class="detail-item">
            <div class="detail-label">Placa/Identificación</div>
            <div class="detail-value">${item.placa}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Serial</div>
            <div class="detail-value">${item.serial}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Fecha</div>
            <div class="detail-value">${formatDate(item.fecha)}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Técnico</div>
            <div class="detail-value">${item.tecnico}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Tipo Mantenimiento</div>
            <div class="detail-value">${item.tipoMantenimiento}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Ubicación</div>
            <div class="detail-value">${item.ubicacion}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Centro de Costo</div>
            <div class="detail-value">${item.centroCosto}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Observaciones</div>
            <div class="detail-value">${item.observaciones || 'N/A'}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Registrado por</div>
            <div class="detail-value">${item.usuarioRegistro || 'Sistema'}</div>
          </div>
        </div>
      `;
      contenedor.appendChild(div);
    });
  }

  document.getElementById('modal-historial').classList.add('active');
}
document.addEventListener('DOMContentLoaded', () => {
  const cerrarHistorialBtn = document.querySelector('.close-modal-historial');
  if (cerrarHistorialBtn) {
    cerrarHistorialBtn.addEventListener('click', () => {
      document.getElementById('modal-historial').classList.remove('active');
    });
  }
});


window.addEventListener('click', (e) => {
  if (e.target === document.getElementById('modal-historial')) {
    document.getElementById('modal-historial').classList.remove('active');
  }
});
let modoPendientes = false; 
let aplicarFiltroFecha = false;

function verPendientes() {
  modoPendientes = true;
  cambiarSeccion('buscar');
  document.getElementById('buscar-input').value = '';
document.getElementById('filtro-desde').value = '';
document.getElementById('filtro-hasta').value = '';

  resultadosBusqueda.innerHTML = '';

  const resultados = registros.filter(r => r.estado === 'Pendiente');

  if (resultados.length === 0) {
    resultadosBusqueda.innerHTML = '<p class="mensaje-vacio">⚠️ No hay registros pendientes</p>';
    return;
  }

  resultados.forEach(registro => {
  const li = document.createElement('li');
  li.className = 'registro-item';

  let statusClass = '';
  if (registro.estado === 'Pendiente') statusClass = 'status-pendiente';
  if (registro.estado === 'En progreso') statusClass = 'status-progreso';
  if (registro.estado === 'Finalizado') statusClass = 'status-finalizado';

li.innerHTML = `
  <div class="registro-header">
    <div class="registro-title">${registro.tipo} - ${registro.placa}</div>
    <div class="registro-actions">
      <span class="status-badge ${statusClass}">${registro.estado}</span>
      <button class="edit-btn" data-id="${registro.id}">Editar</button>
      <button class="delete-btn" data-id="${registro.id}">Eliminar</button>
      <button class="history-btn" data-id="${registro.id}">Ver Historial</button>
    </div>
  </div>
  <div class="registro-details">
    <div class="detail-item"><div class="detail-label">Tipo de Equipo</div><div class="detail-value">${registro.tipo}</div></div>
    <div class="detail-item"><div class="detail-label">Marca</div><div class="detail-value">${registro.marca}</div></div>
    <div class="detail-item"><div class="detail-label">Modelo</div><div class="detail-value">${registro.modelo}</div></div>
    <div class="detail-item"><div class="detail-label">Placa/Identificacion</div><div class="detail-value">${registro.placa}</div></div>
    <div class="detail-item"><div class="detail-label">Serial</div><div class="detail-value">${registro.serial}</div></div>
    <div class="detail-item"><div class="detail-label">Fecha</div><div class="detail-value">${formatDate(registro.fecha)}</div></div>
    <div class="detail-item"><div class="detail-label">Técnico</div><div class="detail-value">${registro.tecnico}</div></div>
    <div class="detail-item"><div class="detail-label">Tipo de Mantenimiento</div><div class="detail-value">${registro.tipoMantenimiento}</div></div>
    <div class="detail-item"><div class="detail-label">Ubicación</div><div class="detail-value">${registro.ubicacion}</div></div>
    <div class="detail-item"><div class="detail-label">Centro de Costo</div><div class="detail-value">${registro.centroCosto}</div></div>
    ${registro.observaciones ? `<div class="detail-item"><div class="detail-label">Observaciones</div><div class="detail-value">${registro.observaciones}</div></div>` : ''}
    ${registro.urlTicket ? `<div class="detail-item"><div class="detail-label">Ticket</div><div class="detail-value"><a href="${registro.urlTicket}" target="_blank">📎Ver ticket</a></div></div>` : ''}
    <div class="detail-item"><div class="detail-label">Registrado por</div><div class="detail-value">${registro.usuarioRegistro || 'Sistema'}</div></div>
  </div>
`;


  resultadosBusqueda.appendChild(li);
  // ... (después de resultados.forEach)
document.querySelectorAll('.edit-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    editarRegistro(id);
  });
});

document.querySelectorAll('.delete-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    eliminarRegistro(id);
  });
});

document.querySelectorAll('.history-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    verHistorial(id);
  });
});

});
}
function verEnProgreso() {
  modoPendientes = true;
  cambiarSeccion('buscar');
  document.getElementById('buscar-input').value = '';
  document.getElementById('filtro-desde').value = '';
  document.getElementById('filtro-hasta').value = '';

  resultadosBusqueda.innerHTML = '';

  const resultados = registros.filter(r => r.estado === 'En progreso');

  if (resultados.length === 0) {
    resultadosBusqueda.innerHTML = '<p class="mensaje-vacio">⚠️ No hay registros en Progreso</p>';
    return;
  }

  resultados.forEach(registro => {
    const li = document.createElement('li');
    li.className = 'registro-item';

    let statusClass = 'status-progreso';

    li.innerHTML = `
      <div class="registro-header">
        <div class="registro-title">${registro.tipo} - ${registro.placa}</div>
        <div class="registro-actions">
          <span class="status-badge ${statusClass}">${registro.estado}</span>
          <button class="edit-btn" data-id="${registro.id}">Editar</button>
          <button class="delete-btn" data-id="${registro.id}">Eliminar</button>
          <button class="history-btn" data-id="${registro.id}">Ver Historial</button>
        </div>
      </div>
      <div class="registro-details">
        <div class="detail-item"><div class="detail-label">Tipo de Equipo</div><div class="detail-value">${registro.tipo}</div></div>
        <div class="detail-item"><div class="detail-label">Marca</div><div class="detail-value">${registro.marca}</div></div>
         <div class="detail-item"><div class="detail-label">Modelo</div><div class="detail-value">${registro.modelo}</div></div>
        <div class="detail-item"><div class="detail-label">Placa/Identificacion</div><div class="detail-value">${registro.placa}</div></div>
        <div class="detail-item"><div class="detail-label">Serial</div><div class="detail-value">${registro.serial}</div></div>
        <div class="detail-item"><div class="detail-label">Fecha</div><div class="detail-value">${formatDate(registro.fecha)}</div></div>
        <div class="detail-item"><div class="detail-label">Técnico</div><div class="detail-value">${registro.tecnico}</div></div>
        <div class="detail-item"><div class="detail-label">Tipo de Mantenimiento</div><div class="detail-value">${registro.tipoMantenimiento}</div></div>
        <div class="detail-item"><div class="detail-label">Ubicación</div><div class="detail-value">${registro.ubicacion}</div></div>
        <div class="detail-item"><div class="detail-label">Centro de Costo</div><div class="detail-value">${registro.centroCosto}</div></div>
        ${registro.observaciones ? `<div class="detail-item"><div class="detail-label">Observaciones</div><div class="detail-value">${registro.observaciones}</div></div>` : ''}
        ${registro.urlTicket ? `<div class="detail-item"><div class="detail-label">Ticket</div><div class="detail-value"><a href="${registro.urlTicket}" target="_blank">📎Ver ticket</a></div></div>` : ''}
        <div class="detail-item"><div class="detail-label">Registrado por</div><div class="detail-value">${registro.usuarioRegistro || 'Sistema'}</div></div>
      </div>
    `;
    resultadosBusqueda.appendChild(li);
    // ... (después de resultados.forEach)
document.querySelectorAll('.edit-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    editarRegistro(id);
  });
});

document.querySelectorAll('.delete-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    eliminarRegistro(id);
  });
});

document.querySelectorAll('.history-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    verHistorial(id);
  });
});

  });
}

function verFinalizados() {
  modoPendientes = true;
  cambiarSeccion('buscar');
  document.getElementById('buscar-input').value = '';
  document.getElementById('filtro-desde').value = '';
  document.getElementById('filtro-hasta').value = '';

  resultadosBusqueda.innerHTML = '';

  const resultados = registros.filter(r => r.estado === 'Finalizado');

  if (resultados.length === 0) {
    resultadosBusqueda.innerHTML = '<p class="mensaje-vacio">⚠️ No hay registros Finalizados</p>';

    return;
  }

  resultados.forEach(registro => {
    const li = document.createElement('li');
    li.className = 'registro-item';

    let statusClass = 'status-finalizado';

    li.innerHTML = `
      <div class="registro-header">
        <div class="registro-title">${registro.tipo} - ${registro.placa}</div>
        <div class="registro-actions">
          <span class="status-badge ${statusClass}">${registro.estado}</span>
          <button class="edit-btn" data-id="${registro.id}">Editar</button>
          <button class="delete-btn" data-id="${registro.id}">Eliminar</button>
          <button class="history-btn" data-id="${registro.id}">Ver Historial</button>
        </div>
      </div>
      <div class="registro-details">
        <div class="detail-item"><div class="detail-label">Tipo de Equipo</div><div class="detail-value">${registro.tipo}</div></div>
        <div class="detail-item"><div class="detail-label">Marca</div><div class="detail-value">${registro.marca}</div></div>
        <div class="detail-item"><div class="detail-label">Modelo</div><div class="detail-value">${registro.modelo}</div></div>
        <div class="detail-item"><div class="detail-label">Placa/Identificacion</div><div class="detail-value">${registro.placa}</div></div>
        <div class="detail-item"><div class="detail-label">Serial</div><div class="detail-value">${registro.serial}</div></div>
        <div class="detail-item"><div class="detail-label">Fecha</div><div class="detail-value">${formatDate(registro.fecha)}</div></div>
        <div class="detail-item"><div class="detail-label">Técnico</div><div class="detail-value">${registro.tecnico}</div></div>
        <div class="detail-item"><div class="detail-label">Tipo de Mantenimiento</div><div class="detail-value">${registro.tipoMantenimiento}</div></div>
        <div class="detail-item"><div class="detail-label">Ubicación</div><div class="detail-value">${registro.ubicacion}</div></div>
        <div class="detail-item"><div class="detail-label">Centro de Costo</div><div class="detail-value">${registro.centroCosto}</div></div>
        ${registro.observaciones ? `<div class="detail-item"><div class="detail-label">Observaciones</div><div class="detail-value">${registro.observaciones}</div></div>` : ''}
        ${registro.urlTicket ? `<div class="detail-item"><div class="detail-label">Ticket</div><div class="detail-value"><a href="${registro.urlTicket}" target="_blank">📎Ver ticket</a></div></div>` : ''}
        <div class="detail-item"><div class="detail-label">Registrado por</div><div class="detail-value">${registro.usuarioRegistro || 'Sistema'}</div></div>
      </div>
    `;
    resultadosBusqueda.appendChild(li);
    // ... (después de resultados.forEach)
document.querySelectorAll('.edit-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    editarRegistro(id);
  });
});

document.querySelectorAll('.delete-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    eliminarRegistro(id);
  });
});

document.querySelectorAll('.history-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const id = e.target.getAttribute('data-id');
    verHistorial(id);
  });
});

  });
}
function verTodosLosRegistros() {
  modoPendientes = false;
  cambiarSeccion('buscar');

  // Limpiar filtros
  document.getElementById('buscar-input').value = '';
  document.getElementById('filtro-desde').value = '';
  document.getElementById('filtro-hasta').value = '';
  resultadosBusqueda.innerHTML = '';

  if (registros.length === 0) {
    resultadosBusqueda.innerHTML = '<p class="mensaje-vacio">⚠️ No hay registros disponibles</p>';
    return;
  }

  registros.forEach(registro => {
    const li = document.createElement('li');
    li.className = 'registro-item';

    let statusClass = '';
    if (registro.estado === 'Pendiente') statusClass = 'status-pendiente';
    if (registro.estado === 'En progreso') statusClass = 'status-progreso';
    if (registro.estado === 'Finalizado') statusClass = 'status-finalizado';

    li.innerHTML = `
      <div class="registro-header">
        <div class="registro-title">${registro.tipo} - ${registro.placa}</div>
        <div class="registro-actions">
          <span class="status-badge ${statusClass}">${registro.estado}</span>
          <button class="edit-btn" data-id="${registro.id}">Editar</button>
          <button class="delete-btn" data-id="${registro.id}">Eliminar</button>
          <button class="history-btn" data-id="${registro.id}">Ver Historial</button>
        </div>
      </div>
      <div class="registro-details">
        <div class="detail-item"><div class="detail-label">Tipo de Equipo</div><div class="detail-value">${registro.tipo}</div></div>
        <div class="detail-item"><div class="detail-label">Marca</div><div class="detail-value">${registro.marca}</div></div>
        <div class="detail-item"><div class="detail-label">Modelo</div><div class="detail-value">${registro.modelo}</div></div>
        <div class="detail-item"><div class="detail-label">Placa/Identificacion</div><div class="detail-value">${registro.placa}</div></div>
        <div class="detail-item"><div class="detail-label">Serial</div><div class="detail-value">${registro.serial}</div></div>
        <div class="detail-item"><div class="detail-label">Fecha</div><div class="detail-value">${formatDate(registro.fecha)}</div></div>
        <div class="detail-item"><div class="detail-label">Técnico</div><div class="detail-value">${registro.tecnico}</div></div>
        <div class="detail-item"><div class="detail-label">Tipo de Mantenimiento</div><div class="detail-value">${registro.tipoMantenimiento}</div></div>
        <div class="detail-item"><div class="detail-label">Ubicación</div><div class="detail-value">${registro.ubicacion}</div></div>
        <div class="detail-item"><div class="detail-label">Centro de Costo</div><div class="detail-value">${registro.centroCosto}</div></div>
        ${registro.observaciones ? `<div class="detail-item"><div class="detail-label">Observaciones</div><div class="detail-value">${registro.observaciones}</div></div>` : ''}
        ${registro.urlTicket ? `<div class="detail-item"><div class="detail-label">Ticket</div><div class="detail-value"><a href="${registro.urlTicket}" target="_blank">🔗 Ver ticket</a></div></div>` : ''}
        <div class="detail-item"><div class="detail-label">Registrado por</div><div class="detail-value">${registro.usuarioRegistro || 'Sistema'}</div></div>
      </div>
    `;

    resultadosBusqueda.appendChild(li);
  });

  // Reasignar listeners
  document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.addEventListener('click', (e) => editarRegistro(e.target.dataset.id));
  });

  document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', (e) => eliminarRegistro(e.target.dataset.id));
  });

  document.querySelectorAll('.history-btn').forEach(btn => {
    btn.addEventListener('click', (e) => verHistorial(e.target.dataset.id));
  });
}

  </script>
 <script>
  window.addEventListener('DOMContentLoaded', () => {
    const alerta = document.getElementById('alerta-sistema');

    // Asegurarnos que esté visible al inicio
    alerta.classList.remove('alerta-oculta');
    alerta.style.display = 'block';

    // Función para alternar visibilidad
    const cicloAlerta = () => {
      // Mostrar alerta
      alerta.classList.remove('alerta-oculta');
      alerta.classList.add('visible');

      // Sonido opcional
      const sonido = document.getElementById('error-sound');
      if (sonido) {
        sonido.currentTime = 0;
        sonido.play();
      }

      // Después de 3 segundos, ocultar
      setTimeout(() => {
        alerta.classList.remove('visible');
        alerta.classList.add('alerta-oculta');

        // Después de 2 segundos más, volver a mostrar
        setTimeout(cicloAlerta, 4000);
      }, 5000);
    };

    // Inicia el ciclo
    cicloAlerta();
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const emoji = document.getElementById("emoji-rebotando");
    const box = document.querySelector(".login-box");

    let posX = 50;
    let posY = 50;
    let velX = 2;
    let velY = 2;

    function moverEmoji() {
      const boxWidth = box.clientWidth;
      const boxHeight = box.clientHeight;
      const emojiWidth = emoji.offsetWidth;
      const emojiHeight = emoji.offsetHeight;

      posX += velX;
      posY += velY;

      if (posX <= 0 || posX + emojiWidth >= boxWidth) velX *= -1;
      if (posY <= 0 || posY + emojiHeight >= boxHeight) velY *= -1;

      emoji.style.left = `${posX}px`;
      emoji.style.top = `${posY}px`;

      requestAnimationFrame(moverEmoji);
    }

    moverEmoji();
  });
</script>

<!-- Modal de Historial -->
<div class="modal" id="modal-historial">
  <div class="modal-content">
    <button class="close-modal-historial" aria-label="Cerrar">
  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="12" fill="#e74c3c"/>
    <path d="M15 9l-6 6M9 9l6 6" stroke="white" stroke-width="2" stroke-linecap="round"/>
  </svg>
</button>
    <h3>Historial de Mantenimientos</h3>
    <div id="historial-contenido"></div>
  </div>
</div>

</body>
</html>